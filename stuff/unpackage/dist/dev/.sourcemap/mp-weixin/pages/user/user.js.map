{"version":3,"file":"user.js","sources":["pages/user/user.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci91c2VyLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"user-info\">\r\n\t\t\t<view class=\"avatar\" @click=\"chooseAvatar\">\r\n\t\t\t\t<image :src=\"profile.avatar || '/static/avatar.png'\" mode=\"aspectFill\"></image>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"info\">\r\n\t\t\t\t<text class=\"username\">{{username}}</text>\r\n\t\t\t\t<text class=\"user-email\">{{profile.email || '未设置邮箱'}}</text>\r\n\t\t\t\t<view class=\"role-info\">\r\n\t\t\t\t\t<text class=\"role-tag\">{{profile.roleDesc}}</text>\r\n\t\t\t\t\t<text class=\"family-role\" v-for=\"(role, index) in profile.familyRoles\" :key=\"index\">\r\n\t\t\t\t\t\t{{role.familyName}}: {{role.roleDesc}}\r\n\t\t\t\t\t</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t\r\n\t\t<view class=\"menu-list\">\r\n\t\t\t<view class=\"menu-item\" v-if=\"canManageItems\" @click=\"navigateTo('/pages/category/category')\">\r\n\t\t\t\t<text>分类管理</text>\r\n\t\t\t\t<text class=\"arrow\">></text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"menu-item\" @click=\"showFavorites\">\r\n\t\t\t\t<text>我的收藏</text>\r\n\t\t\t\t<text class=\"arrow\">></text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"menu-item\" v-if=\"canManageItems\" @click=\"showReminders\">\r\n\t\t\t\t<text>我的提醒</text>\r\n\t\t\t\t<text class=\"arrow\">></text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"menu-item\" @click=\"showProfilePopup\">\r\n\t\t\t\t<text>我的信息</text>\r\n\t\t\t\t<text class=\"arrow\">></text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"menu-item\" @click=\"showPasswordPopup\">\r\n\t\t\t\t<text>修改密码</text>\r\n\t\t\t\t<text class=\"arrow\">></text>\r\n\t\t\t</view>\r\n\t\t\t<!-- <view class=\"menu-item\">\r\n\t\t\t\t<text>关于我们</text>\r\n\t\t\t\t<text class=\"arrow\">></text>\r\n\t\t\t</view> -->\r\n\t\t</view>\r\n\t\t\r\n\t\t<button class=\"logout-btn\" @click=\"handleLogout\">退出登录</button>\r\n\t\t\r\n\t\t<!-- 收藏列表弹窗 -->\r\n\t\t<uni-popup ref=\"favoritesPopup\" type=\"bottom\">\r\n\t\t\t<view class=\"favorites-popup\">\r\n\t\t\t\t<view class=\"popup-header\">\r\n\t\t\t\t\t<text class=\"title\">我的收藏</text>\r\n\t\t\t\t\t<text class=\"close\" @click=\"hideFavorites\">×</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<scroll-view class=\"favorites-list\" scroll-y>\r\n\t\t\t\t\t<view v-if=\"favorites.length === 0\" class=\"empty-tip\">\r\n\t\t\t\t\t\t<text>暂无收藏物品</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view v-else v-for=\"(favorite, index) in favorites\" :key=\"favorite.id\" class=\"favorite-item\">\r\n\t\t\t\t\t\t<view class=\"item-content\" @click=\"navigateToDetail(favorite.item.id)\">\r\n\t\t\t\t\t\t\t<image class=\"item-image\" :src=\"favorite.item.imageUrl || '/static/default-item.png'\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t\t\t<view class=\"item-info\">\r\n\t\t\t\t\t\t\t\t<text class=\"item-name\">{{favorite.item.name}}</text>\r\n\t\t\t\t\t\t\t\t<text class=\"item-category\">{{favorite.item.category?.name || '未分类'}}</text>\r\n\t\t\t\t\t\t\t\t<text class=\"item-quantity\">数量：{{favorite.item.quantity}}</text>\r\n\t\t\t\t\t\t\t\t<text class=\"item-location\">位置：{{favorite.item.location || '暂无'}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"favorite-btn\" @click.stop=\"toggleFavorite(favorite)\">\r\n\t\t\t\t\t\t\t<text class=\"icon active\">★</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</scroll-view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t\t\r\n\t\t<!-- 提醒列表弹窗 -->\r\n\t\t<uni-popup ref=\"remindersPopup\" type=\"bottom\">\r\n\t\t\t<view class=\"reminders-popup\">\r\n\t\t\t\t<view class=\"popup-header\">\r\n\t\t\t\t\t<text class=\"title\">我的提醒</text>\r\n\t\t\t\t\t<text class=\"close\" @click=\"hideReminders\">×</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<scroll-view class=\"reminders-list\" scroll-y>\r\n\t\t\t\t\t<view v-if=\"!hasReminders\" class=\"empty-tip\">\r\n\t\t\t\t\t\t<text>暂无提醒设置</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<!-- 库存提醒 -->\r\n\t\t\t\t\t<view v-if=\"stockReminders.length > 0\" class=\"reminder-section\">\r\n\t\t\t\t\t\t<view class=\"section-title\">库存提醒</view>\r\n\t\t\t\t\t\t<view \r\n\t\t\t\t\t\t\tclass=\"reminder-item\" \r\n\t\t\t\t\t\t\tv-for=\"(reminder, index) in stockReminders\" \r\n\t\t\t\t\t\t\t:key=\"'stock-' + index\"\r\n\t\t\t\t\t\t\t@click=\"navigateToDetail(reminder.itemId)\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<view class=\"reminder-header\">\r\n\t\t\t\t\t\t\t\t<text class=\"item-name\">{{reminder.itemName}}</text>\r\n\t\t\t\t\t\t\t\t<text class=\"location\">{{reminder.location}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"reminder-content\">\r\n\t\t\t\t\t\t\t\t<text class=\"threshold\">库存阈值：{{reminder.threshold}}</text>\r\n\t\t\t\t\t\t\t\t<text class=\"current\">当前库存：{{reminder.currentQuantity}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<!-- 使用提醒 -->\r\n\t\t\t\t\t<view v-if=\"usageReminders.length > 0\" class=\"reminder-section\">\r\n\t\t\t\t\t\t<view class=\"section-title\">使用提醒</view>\r\n\t\t\t\t\t\t<view \r\n\t\t\t\t\t\t\tclass=\"reminder-item\" \r\n\t\t\t\t\t\t\tv-for=\"(reminder, index) in usageReminders\" \r\n\t\t\t\t\t\t\t:key=\"'usage-' + index\"\r\n\t\t\t\t\t\t\t@click=\"navigateToDetail(reminder.itemId)\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<view class=\"reminder-header\">\r\n\t\t\t\t\t\t\t\t<text class=\"item-name\">{{reminder.itemName}}</text>\r\n\t\t\t\t\t\t\t\t<text class=\"location\">{{reminder.location}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"reminder-content\">\r\n\t\t\t\t\t\t\t\t<text class=\"interval\">使用间隔：{{reminder.interval}}天</text>\r\n\t\t\t\t\t\t\t\t<text class=\"last-usage\">上次使用：{{formatTime(reminder.lastUsageTime)}}</text>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</scroll-view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t\t\r\n\t\t<!-- 个人信息修改弹窗 -->\r\n\t\t<uni-popup ref=\"profilePopup\" type=\"bottom\">\r\n\t\t\t<view class=\"profile-popup\">\r\n\t\t\t\t<view class=\"popup-header\">\r\n\t\t\t\t\t<text class=\"title\">个人信息</text>\r\n\t\t\t\t\t<text class=\"close\" @click=\"hideProfilePopup\">×</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<view class=\"profile-form\">\r\n\t\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t\t<text class=\"label\">用户名</text>\r\n\t\t\t\t\t\t<input type=\"text\" v-model=\"profile.username\" placeholder=\"请输入用户名\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t\t<text class=\"label\">昵称</text>\r\n\t\t\t\t\t\t<input type=\"text\" v-model=\"profile.nickname\" placeholder=\"请输入昵称\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t\t<text class=\"label\">邮箱</text>\r\n\t\t\t\t\t\t<input type=\"text\" v-model=\"profile.email\" placeholder=\"请输入邮箱\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<button class=\"submit-btn\" @click=\"handleUpdateProfile\">保存修改</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t\t\r\n\t\t<!-- 修改密码弹窗 -->\r\n\t\t<uni-popup ref=\"passwordPopup\" type=\"bottom\">\r\n\t\t\t<view class=\"password-popup\">\r\n\t\t\t\t<view class=\"popup-header\">\r\n\t\t\t\t\t<text class=\"title\">修改密码</text>\r\n\t\t\t\t\t<text class=\"close\" @click=\"hidePasswordPopup\">×</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t\t\t<view class=\"password-form\">\r\n\t\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t\t<text class=\"label\">旧密码</text>\r\n\t\t\t\t\t\t<input type=\"password\" v-model=\"passwordForm.oldPassword\" placeholder=\"请输入旧密码\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t\t<text class=\"label\">新密码</text>\r\n\t\t\t\t\t\t<input type=\"password\" v-model=\"passwordForm.newPassword\" placeholder=\"请输入新密码\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<view class=\"form-item\">\r\n\t\t\t\t\t\t<text class=\"label\">确认密码</text>\r\n\t\t\t\t\t\t<input type=\"password\" v-model=\"passwordForm.confirmPassword\" placeholder=\"请再次输入新密码\" />\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t\t\t<button class=\"submit-btn\" @click=\"handleUpdatePassword\">确认修改</button>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { favoriteApi } from '@/api/favorite'\r\nimport { userApi } from '@/api/user'\r\nimport { reminderApi } from '@/api/reminder'\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tusername: '',\r\n\t\t\tuserId: '',\r\n\t\t\tfavorites: [],\r\n\t\t\tcurrentPage: 0,\r\n\t\t\tpageSize: 10,\r\n\t\t\thasMore: true,\r\n\t\t\tprofile: {\r\n\t\t\t\tusername: '',\r\n\t\t\t\temail: '',\r\n\t\t\t\tnickname: '',\r\n\t\t\t\tavatar: '',\r\n\t\t\t\trole: '',\r\n\t\t\t\troleDesc: '',\r\n\t\t\t\tfamilyRoles: []\r\n\t\t\t},\r\n\t\t\t// 修改密码表单\r\n\t\t\tpasswordForm: {\r\n\t\t\t\toldPassword: '',\r\n\t\t\t\tnewPassword: '',\r\n\t\t\t\tconfirmPassword: ''\r\n\t\t\t},\r\n\t\t\tstockReminders: [],\r\n\t\t\tusageReminders: [],\r\n\t\t\thasReminders: false\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\tcanManageItems() {\r\n\t\t\t// 如果有家庭角色，则检查家庭角色权限\r\n\t\t\tif (this.profile.familyRoles && this.profile.familyRoles.length > 0) {\r\n\t\t\t\treturn this.profile.familyRoles.some(role => \r\n\t\t\t\t\trole.role === 'ADMIN' || role.role === 'MEMBER'\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\t// 如果没有家庭角色，则使用全局角色\r\n\t\t\treturn this.profile.role === 'ADMIN' || this.profile.role === 'MEMBER'\r\n\t\t},\r\n\t\tisAdmin() {\r\n\t\t\t// 如果有家庭角色，则检查是否有管理员权限\r\n\t\t\tif (this.profile.familyRoles && this.profile.familyRoles.length > 0) {\r\n\t\t\t\treturn this.profile.familyRoles.some(role => role.role === 'ADMIN')\r\n\t\t\t}\r\n\t\t\t// 如果没有家庭角色，则使用全局角色\r\n\t\t\treturn this.profile.role === 'ADMIN'\r\n\t\t}\r\n\t},\r\n\tonShow() {\r\n\t\tthis.userId = uni.getStorageSync('userId') || ''\r\n\t\tthis.loadUserProfile()\r\n\t},\r\n\tmethods: {\r\n\t\tasync loadUserProfile() {\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await userApi.getProfile(this.userId)\r\n\t\t\t\tthis.profile = res.profile\r\n\t\t\t\tthis.username = this.profile.nickname || this.profile.username\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('获取用户信息失败:', e)\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tshowProfilePopup() {\r\n\t\t\tthis.$refs.profilePopup.open()\r\n\t\t},\r\n\t\t\r\n\t\thideProfilePopup() {\r\n\t\t\tthis.$refs.profilePopup.close()\r\n\t\t},\r\n\t\t\r\n\t\tshowPasswordPopup() {\r\n\t\t\tthis.$refs.passwordPopup.open()\r\n\t\t},\r\n\t\t\r\n\t\thidePasswordPopup() {\r\n\t\t\tthis.$refs.passwordPopup.close()\r\n\t\t\t// 清空密码表单\r\n\t\t\tthis.passwordForm = {\r\n\t\t\t\toldPassword: '',\r\n\t\t\t\tnewPassword: '',\r\n\t\t\t\tconfirmPassword: ''\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tasync handleUpdateProfile() {\r\n\t\t\ttry {\r\n\t\t\t\tawait userApi.updateProfile(this.userId, this.profile)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '更新成功',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t})\r\n\t\t\t\tthis.hideProfilePopup()\r\n\t\t\t\tthis.loadUserProfile()\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: e.message || '更新失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\tasync handleUpdatePassword() {\r\n\t\t\tif (!this.passwordForm.oldPassword || !this.passwordForm.newPassword) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请输入密码',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this.passwordForm.newPassword !== this.passwordForm.confirmPassword) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '两次输入的新密码不一致',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tawait userApi.updatePassword(this.userId, {\r\n\t\t\t\t\toldPassword: this.passwordForm.oldPassword,\r\n\t\t\t\t\tnewPassword: this.passwordForm.newPassword\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '密码修改成功',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t})\r\n\t\t\t\tthis.hidePasswordPopup()\r\n\t\t\t\t\r\n\t\t\t\t// 密码修改成功后退出登录\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tthis.handleLogout()\r\n\t\t\t\t}, 1500)\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: e.message || '修改失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\thandleLogout() {\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent: '确定要退出登录吗？',\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\tuni.clearStorageSync()\r\n\t\t\t\t\t\tuni.reLaunch({\r\n\t\t\t\t\t\t\turl: '/pages/index/index'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tnavigateTo(url) {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl\r\n\t\t\t})\r\n\t\t},\r\n\t\tnavigateToDetail(itemId) {\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl: `/pages/item/detail?id=${itemId}`\r\n\t\t\t})\r\n\t\t},\r\n\t\tshowFavorites() {\r\n\t\t\tthis.currentPage = 0\r\n\t\t\tthis.hasMore = true\r\n\t\t\tthis.favorites = []\r\n\t\t\tthis.loadFavorites()\r\n\t\t\tthis.$refs.favoritesPopup.open()\r\n\t\t},\r\n\t\thideFavorites() {\r\n\t\t\tthis.$refs.favoritesPopup.close()\r\n\t\t},\r\n\t\tasync loadFavorites() {\r\n\t\t\tif (!this.hasMore) return\r\n\t\t\t\r\n\t\t\ttry {\r\n\t\t\t\tconst userId = uni.getStorageSync('userId')\r\n\t\t\t\tconst res = await favoriteApi.getList(userId, {\r\n\t\t\t\t\tpage: this.currentPage,\r\n\t\t\t\t\tsize: this.pageSize\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tconst newItems = res.favorites || []\r\n\t\t\t\tthis.favorites = [...this.favorites, ...newItems]\r\n\t\t\t\tthis.hasMore = newItems.length === this.pageSize\r\n\t\t\t\tthis.currentPage++\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '获取收藏列表失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync toggleFavorite(favorite) {\r\n\t\t\ttry {\r\n\t\t\t\tconst userId = uni.getStorageSync('userId')\r\n\t\t\t\tawait favoriteApi.remove(favorite.item.id, userId)\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '已取消收藏',\r\n\t\t\t\t\ticon: 'success'\r\n\t\t\t\t})\r\n\t\t\t\t// 从列表中移除\r\n\t\t\t\tthis.favorites = this.favorites.filter(f => f.id !== favorite.id)\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: e.message || '操作失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tshowReminders() {\r\n\t\t\tthis.loadReminders()\r\n\t\t\tthis.$refs.remindersPopup.open()\r\n\t\t},\r\n\t\thideReminders() {\r\n\t\t\tthis.$refs.remindersPopup.close()\r\n\t\t},\r\n\t\tasync loadReminders() {\r\n\t\t\ttry {\r\n\t\t\t\tconst userId = uni.getStorageSync('userId')\r\n\t\t\t\tconst res = await reminderApi.getAlerts(userId)\r\n\t\t\t\tthis.stockReminders = res.data.lowStockAlerts || []\r\n\t\t\t\tthis.usageReminders = res.data.usageAlerts || []\r\n\t\t\t\tthis.hasReminders = this.stockReminders.length > 0 || this.usageReminders.length > 0\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '获取提醒列表失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tformatTime(timestamp) {\r\n\t\t\tconst date = new Date(timestamp)\r\n\t\t\treturn date.toLocaleString()\r\n\t\t},\r\n\t\tasync chooseAvatar() {\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await uni.chooseImage({\r\n\t\t\t\t\tcount: 1,\r\n\t\t\t\t\tsizeType: ['compressed'],\r\n\t\t\t\t\tsourceType: ['album', 'camera']\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif (res.tempFilePaths && res.tempFilePaths.length > 0) {\r\n\t\t\t\t\tconst filePath = res.tempFilePaths[0]\r\n\t\t\t\t\tawait this.uploadAvatar(filePath)\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error('选择图片失败:', e)\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync uploadAvatar(filePath) {\r\n\t\t\ttry {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: '上传中...'\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tconst result = await userApi.uploadAvatar(this.userId, filePath)\r\n\t\t\t\t\r\n\t\t\t\tif (result.success) {\r\n\t\t\t\t\t// 更新本地头像\r\n\t\t\t\t\tthis.profile.avatar = result.avatar\r\n\t\t\t\t\t// 重新加载用户信息\r\n\t\t\t\t\tawait this.loadUserProfile()\r\n\t\t\t\t\t\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '上传成功',\r\n\t\t\t\t\t\ticon: 'success'\r\n\t\t\t\t\t})\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(result.message || '上传失败')\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: e.message || '上传失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t})\r\n\t\t\t} finally {\r\n\t\t\t\tuni.hideLoading()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style>\r\n.container {\r\n\tpadding: 20rpx;\r\n}\r\n\r\n.user-info {\r\n\tpadding: 40rpx;\r\n\tbackground-color: #007AFF;\r\n\tborder-radius: 16rpx;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.avatar {\r\n\twidth: 120rpx;\r\n\theight: 120rpx;\r\n\tborder-radius: 60rpx;\r\n\toverflow: hidden;\r\n\tmargin-right: 30rpx;\r\n\tborder: 2rpx solid rgba(255,255,255,0.3);\r\n}\r\n\r\n.avatar image {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n}\r\n\r\n.avatar:active {\r\n\topacity: 0.8;\r\n}\r\n\r\n.info {\r\n\tcolor: #fff;\r\n}\r\n\r\n.username {\r\n\tfont-size: 36rpx;\r\n\tfont-weight: bold;\r\n\tmargin-bottom: 10rpx;\r\n\tdisplay: block;\r\n}\r\n\r\n.user-email {\r\n\tfont-size: 24rpx;\r\n\topacity: 0.8;\r\n}\r\n\r\n.role-info {\r\n\tmargin-top: 10rpx;\r\n}\r\n\r\n.role-tag {\r\n\tfont-size: 24rpx;\r\n\tcolor: #fff;\r\n\tbackground: rgba(255,255,255,0.2);\r\n\tpadding: 4rpx 12rpx;\r\n\tborder-radius: 20rpx;\r\n\tmargin-right: 10rpx;\r\n}\r\n\r\n.family-role {\r\n\tfont-size: 24rpx;\r\n\tcolor: #fff;\r\n\topacity: 0.8;\r\n\tdisplay: block;\r\n\tmargin-top: 6rpx;\r\n}\r\n\r\n.menu-list {\r\n\tbackground-color: #fff;\r\n\tborder-radius: 16rpx;\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.menu-item {\r\n\tpadding: 30rpx;\r\n\tborder-bottom: 1rpx solid #eee;\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n}\r\n\r\n.menu-item:last-child {\r\n\tborder-bottom: none;\r\n}\r\n\r\n.arrow {\r\n\tcolor: #999;\r\n}\r\n\r\n.logout-btn {\r\n\twidth: 100%;\r\n\tbackground-color: #ff4d4f;\r\n\tcolor: #fff;\r\n\tmargin-top: 40rpx;\r\n}\r\n\r\n.favorites-popup {\r\n\tbackground-color: #fff;\r\n\tborder-radius: 24rpx 24rpx 0 0;\r\n\tpadding: 30rpx;\r\n\theight: 80vh;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.popup-header {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.popup-header .title {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n}\r\n\r\n.popup-header .close {\r\n\tfont-size: 40rpx;\r\n\tcolor: #999;\r\n\tpadding: 10rpx;\r\n}\r\n\r\n.favorites-list {\r\n\tflex: 1;\r\n\toverflow-y: auto;\r\n}\r\n\r\n.empty-tip {\r\n\ttext-align: center;\r\n\tpadding: 100rpx 0;\r\n\tcolor: #999;\r\n}\r\n\r\n.favorite-item {\r\n\tbackground: #fff;\r\n\tborder-bottom: 1rpx solid #eee;\r\n\tpadding: 20rpx;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n\r\n.item-content {\r\n\tflex: 1;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n\r\n.item-image {\r\n\twidth: 120rpx;\r\n\theight: 120rpx;\r\n\tborder-radius: 8rpx;\r\n\tmargin-right: 20rpx;\r\n}\r\n\r\n.item-info {\r\n\tflex: 1;\r\n}\r\n\r\n.item-name {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tmargin-bottom: 10rpx;\r\n\tdisplay: block;\r\n}\r\n\r\n.item-category {\r\n\tfont-size: 24rpx;\r\n\tcolor: #007AFF;\r\n\tbackground: rgba(0,122,255,0.1);\r\n\tpadding: 4rpx 12rpx;\r\n\tborder-radius: 20rpx;\r\n\tdisplay: inline-block;\r\n\tmargin-bottom: 10rpx;\r\n}\r\n\r\n.item-quantity, .item-location {\r\n\tfont-size: 24rpx;\r\n\tcolor: #666;\r\n\tdisplay: block;\r\n\tmargin-bottom: 6rpx;\r\n}\r\n\r\n.favorite-btn {\r\n\tpadding: 20rpx;\r\n}\r\n\r\n.favorite-btn .icon {\r\n\tfont-size: 48rpx;\r\n\tcolor: #999;\r\n}\r\n\r\n.favorite-btn .icon.active {\r\n\tcolor: #ff6b6b;\r\n}\r\n\r\n.profile-popup, .password-popup {\r\n\tbackground-color: #fff;\r\n\tborder-radius: 24rpx 24rpx 0 0;\r\n\tpadding: 30rpx;\r\n\tmin-height: 60vh;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.profile-form, .password-form {\r\n\tpadding: 20rpx;\r\n\tflex: 1;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.form-item {\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.form-item .label {\r\n\tdisplay: block;\r\n\tfont-size: 28rpx;\r\n\tcolor: #333;\r\n\tmargin-bottom: 10rpx;\r\n}\r\n\r\n.form-item input {\r\n\twidth: 100%;\r\n\theight: 80rpx;\r\n\tborder: 1rpx solid #eee;\r\n\tborder-radius: 8rpx;\r\n\tpadding: 0 20rpx;\r\n\tbox-sizing: border-box;\r\n}\r\n\r\n.submit-btn {\r\n\twidth: 100%;\r\n\theight: 80rpx;\r\n\tline-height: 80rpx;\r\n\tbackground: #007AFF;\r\n\tcolor: #fff;\r\n\tborder-radius: 8rpx;\r\n\tmargin-bottom: 20rpx;\r\n}\r\n\r\n.reminders-popup {\r\n\tbackground-color: #fff;\r\n\tborder-radius: 24rpx 24rpx 0 0;\r\n\tpadding: 30rpx;\r\n\theight: 80vh;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.reminders-list {\r\n\tflex: 1;\r\n\toverflow-y: auto;\r\n}\r\n\r\n.reminder-section {\r\n\tmargin-bottom: 30rpx;\r\n}\r\n\r\n.section-title {\r\n\tfont-size: 32rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n\tmargin-bottom: 20rpx;\r\n\tpadding: 0 20rpx;\r\n}\r\n\r\n.reminder-item {\r\n\tbackground: #f8f8f8;\r\n\tborder-radius: 12rpx;\r\n\tpadding: 20rpx;\r\n\tmargin: 0 20rpx 20rpx;\r\n}\r\n\r\n.reminder-header {\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\talign-items: center;\r\n\tmargin-bottom: 10rpx;\r\n}\r\n\r\n.reminder-header .item-name {\r\n\tfont-size: 28rpx;\r\n\tfont-weight: bold;\r\n\tcolor: #333;\r\n}\r\n\r\n.reminder-header .location {\r\n\tfont-size: 24rpx;\r\n\tcolor: #666;\r\n\tbackground: #fff;\r\n\tpadding: 4rpx 12rpx;\r\n\tborder-radius: 20rpx;\r\n}\r\n\r\n.reminder-content {\r\n\tfont-size: 24rpx;\r\n\tcolor: #666;\r\n}\r\n\r\n.reminder-content .threshold,\r\n.reminder-content .current,\r\n.reminder-content .interval,\r\n.reminder-content .last-usage {\r\n\tdisplay: block;\r\n\tmargin-top: 6rpx;\r\n}\r\n\r\n.reminder-content .current,\r\n.reminder-content .last-usage {\r\n\tcolor: #ff6b6b;\r\n}\r\n</style> ","import MiniProgramPage from 'C:/Users/Administrator/Desktop/论文/project/garguateproject/stuff/pages/user/user.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","userApi","favoriteApi","reminderApi"],"mappings":"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"}